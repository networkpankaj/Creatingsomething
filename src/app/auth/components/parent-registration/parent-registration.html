<div class="registration-container">
  <div class="registration-card">
    <!-- Header with progress -->
    <div class="registration-header">
      <h1 class="title">Parent/Student Registration</h1>
      <p class="subtitle">Complete your profile to get started</p>
      
      <!-- Progress bar -->
      <div class="progress-container">
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="(currentStep / totalSteps) * 100"></div>
        </div>
        <span class="progress-text">Step {{ currentStep }}/{{ totalSteps }}</span>
      </div>
      
      <!-- Step indicators -->
      <div class="step-indicators">
        <div class="step-item" [class.active]="currentStep >= 1" [class.completed]="currentStep > 1">
          <div class="step-circle">
            <span *ngIf="currentStep > 1">✓</span>
            <span *ngIf="currentStep <= 1">1</span>
          </div>
          <span class="step-label">Personal</span>
        </div>
        
        <div class="step-item" [class.active]="currentStep >= 2" [class.completed]="currentStep > 2">
          <div class="step-circle">
            <span *ngIf="currentStep > 2">✓</span>
            <span *ngIf="currentStep <= 2">2</span>
          </div>
          <span class="step-label">Address</span>
        </div>
        
        <div class="step-item" [class.active]="currentStep >= 3" [class.completed]="currentStep > 3">
          <div class="step-circle">
            <span *ngIf="currentStep > 3">✓</span>
            <span *ngIf="currentStep <= 3">3</span>
          </div>
          <span class="step-label">Student</span>
        </div>
        
        <div class="step-item" [class.active]="currentStep >= 4">
          <div class="step-circle">
            <span>4</span>
          </div>
          <span class="step-label">Payment</span>
        </div>
      </div>
    </div>

    <!-- Form content -->
    <div class="form-content">
      
      <!-- Step 1: Personal Information -->
      <div *ngIf="currentStep === 1" class="step-form">
        <h2 class="form-title">Parent/Student Information</h2>
        
        <div class="form-group">
          <label class="form-label">First Name</label>
          <input 
            type="text" 
            class="form-input" 
            [(ngModel)]="formData.firstName"
            name="firstName"
            placeholder="Enter your first name"
            required>
        </div>
        
        <div class="form-group">
          <label class="form-label">Last Name</label>
          <input 
            type="text" 
            class="form-input" 
            [(ngModel)]="formData.lastName"
            name="lastName"
            placeholder="Enter your last name"
            required>
        </div>
        
        <div class="form-group">
          <label class="form-label">Email Address</label>
          <input 
            type="email" 
            class="form-input" 
            [(ngModel)]="formData.email"
            name="email"
            placeholder="Enter your email address"
            required>
        </div>
        
        <div class="form-group">
          <label class="form-label">Phone Number</label>
          <input 
            type="tel" 
            class="form-input" 
            [(ngModel)]="formData.phone"
            name="phone"
            placeholder="Enter your phone number"
            required>
        </div>
        
        <!-- Profile Photo Upload -->
        <div class="form-group">
          <label class="form-label">Profile Photo (Optional)</label>
          <input 
            type="file" 
            class="form-input" 
            (change)="onFileSelected($event)"
            accept="image/*"
            name="profilePhoto">
          <small class="form-hint">Maximum file size: 5MB. Accepted formats: JPG, PNG, GIF</small>
        </div>
        
        <div class="form-actions single">
          <button type="button" class="btn-continue" (click)="nextStep()">
            Continue
          </button>
        </div>
      </div>

      <!-- Step 2: Address Information -->
      <div *ngIf="currentStep === 2" class="step-form">
        <h2 class="form-title">Address Information</h2>
        
        <div class="form-group">
          <label class="form-label">Address</label>
          <input 
            type="text" 
            class="form-input" 
            [(ngModel)]="formData.address"
            name="address"
            placeholder="Enter your full address"
            required>
        </div>
        
        <div class="form-row city-state-zip">
          <div class="form-group city-group">
            <label class="form-label">City</label>
            <input 
              type="text" 
              class="form-input city-input" 
              [(ngModel)]="formData.city"
              name="city"
              placeholder="Enter your city"
              required>
          </div>
          
          <div class="form-group state-group">
            <label class="form-label">State</label>
            <select 
              class="form-input state-select" 
              [(ngModel)]="formData.state"
              name="state"
              required>
              <option value="">Select State</option>
              <option value="Andhra Pradesh">Andhra Pradesh</option>
              <option value="Arunachal Pradesh">Arunachal Pradesh</option>
              <option value="Assam">Assam</option>
              <option value="Bihar">Bihar</option>
              <option value="Chhattisgarh">Chhattisgarh</option>
              <option value="Goa">Goa</option>
              <option value="Gujarat">Gujarat</option>
              <option value="Haryana">Haryana</option>
              <option value="Himachal Pradesh">Himachal Pradesh</option>
              <option value="Jharkhand">Jharkhand</option>
              <option value="Karnataka">Karnataka</option>
              <option value="Kerala">Kerala</option>
              <option value="Madhya Pradesh">Madhya Pradesh</option>
              <option value="Maharashtra">Maharashtra</option>
              <option value="Manipur">Manipur</option>
              <option value="Meghalaya">Meghalaya</option>
              <option value="Mizoram">Mizoram</option>
              <option value="Nagaland">Nagaland</option>
              <option value="Odisha">Odisha</option>
              <option value="Punjab">Punjab</option>
              <option value="Rajasthan">Rajasthan</option>
              <option value="Sikkim">Sikkim</option>
              <option value="Tamil Nadu">Tamil Nadu</option>
              <option value="Telangana">Telangana</option>
              <option value="Tripura">Tripura</option>
              <option value="Uttar Pradesh">Uttar Pradesh</option>
              <option value="Uttarakhand">Uttarakhand</option>
              <option value="West Bengal">West Bengal</option>
              <optgroup label="Union Territories">
                <option value="Andaman and Nicobar Islands">Andaman and Nicobar Islands</option>
                <option value="Chandigarh">Chandigarh</option>
                <option value="Dadra and Nagar Haveli and Daman and Diu">Dadra and Nagar Haveli and Daman and Diu</option>
                <option value="Delhi">Delhi</option>
                <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                <option value="Ladakh">Ladakh</option>
                <option value="Lakshadweep">Lakshadweep</option>
                <option value="Puducherry">Puducherry</option>
              </optgroup>
            </select>
          </div>
          
          <div class="form-group zip-group">
            <label class="form-label">PIN Code</label>
            <input 
              type="text" 
              class="form-input pin-input" 
              [(ngModel)]="formData.zipCode"
              name="zipCode"
              placeholder="000000"
              pattern="[0-9]{6}"
              maxlength="6"
              required>
            <small class="form-hint">6-digit PIN code</small>
          </div>
        </div>
        
        <!-- Custom City Input (if Other is selected) -->
        <div class="form-group" *ngIf="formData.city === 'Other'">
          <label class="form-label">Enter Your City</label>
          <input 
            type="text" 
            class="form-input" 
            [(ngModel)]="formData.customCity"
            name="customCity"
            placeholder="Enter your city name"
            required>
        </div>
        
        <div class="form-actions">
          <button type="button" class="btn-back" (click)="previousStep()">
            Previous
          </button>
          <button type="button" class="btn-continue" (click)="nextStep()">
            Next Step
          </button>
        </div>
      </div>

      <!-- Step 3: Children Information -->
      <div *ngIf="currentStep === 3" class="step-form">
        <h2 class="form-title">Student Information</h2>
        
        <div *ngFor="let student of formData.students; let i = index" class="student-card">
          <div class="student-header">
            <h3 class="student-title">Student {{ i + 1 }}</h3>
            <button *ngIf="formData.students.length > 1" 
              type="button" 
              class="btn-remove" 
              (click)="removeStudent(i)">
              Remove
            </button>
          </div>
          
          <div class="form-group">
            <label class="form-label">Student Name</label>
            <input 
              type="text" 
              class="form-input" 
              [(ngModel)]="student.name"
              [name]="'studentName' + i"
              placeholder="Enter student's full name"
              required>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Grade</label>
              <select 
                class="form-input" 
                [(ngModel)]="student.grade"
                [name]="'studentGrade' + i"
                required>
                <option value="">Select grade</option>
                <option *ngFor="let grade of grades" [value]="grade">
                  {{ grade }}
                </option>
              </select>
            </div>
            
            <div class="form-group">
              <label class="form-label">Age</label>
              <input 
                type="number" 
                class="form-input" 
                [(ngModel)]="student.age"
                [name]="'studentAge' + i"
                placeholder="Age"
                min="3"
                max="18">
            </div>
          </div>
          
          <!-- Previous Class Marks/Grades Field - NEW -->
          <div class="form-group">
            <label class="form-label">Previous Class Marks/Grades (Optional)</label>
            <input 
              type="text" 
              class="form-input" 
              [(ngModel)]="student.previousMarks"
              [name]="'studentPreviousMarks' + i"
              placeholder="e.g., Math: 85%, Science: 78%, English: 90% or Grade A/B/C"
              maxlength="200">
            <small class="form-hint">Enter percentage marks or letter grades from previous class/year. This helps us understand your child's academic level.</small>
          </div>
          
          <div class="form-group">
            <label class="form-label">Subjects Needed</label>
            <div class="checkbox-grid">
              <label 
                *ngFor="let subject of subjects" 
                class="checkbox-item"
                [class.selected]="student.subjects.includes(subject)">
                <input 
                  type="checkbox" 
                  [checked]="student.subjects.includes(subject)"
                  (change)="toggleStudentSubject(i, subject)"
                  [name]="'studentSubject' + i + subject">
                <span class="checkmark"></span>
                {{ subject }}
              </label>
            </div>
          </div>
          
          <div class="form-group">
            <label class="form-label">Special Requirements</label>
            <textarea 
              class="form-input" 
              [(ngModel)]="student.challenges"
              [name]="'studentChallenges' + i"
              placeholder="Any learning challenges, special needs, or specific requirements"
              rows="3">
            </textarea>
          </div>
        </div>
        
        <button type="button" class="btn-add-student" (click)="addStudent()">
          + Add Another Child
        </button>
        
        <div class="form-actions">
          <button type="button" class="btn-back" (click)="previousStep()">
            Back
          </button>
          <button type="button" class="btn-continue" (click)="nextStep()">
            Continue
          </button>
        </div>
      </div>

      <!-- Step 4: Services & Payment -->
      <div *ngIf="currentStep === 4" class="step-form">
        <h2 class="form-title">Services & Payment</h2>
        
        <div class="services-section">
          <h3 class="section-title">Select Services</h3>
          
          <div class="services-grid">
            <label class="service-item" [class.selected]="formData.services.includes('tutoring')">
              <input 
                type="checkbox" 
                value="tutoring"
                (change)="toggleService('tutoring')"
                name="serviceTutoring">
              <span class="service-icon">📚</span>
              <div class="service-content">
                <h4>Tutoring</h4>
                <p>One-on-one academic support</p>
              </div>
            </label>
            
            <label class="service-item" [class.selected]="formData.services.includes('homework')">
              <input 
                type="checkbox" 
                value="homework"
                (change)="toggleService('homework')"
                name="serviceHomework">
              <span class="service-icon">📝</span>
              <div class="service-content">
                <h4>Homework Help</h4>
                <p>Assistance with daily assignments</p>
              </div>
            </label>
            
            <label class="service-item" [class.selected]="formData.services.includes('test-prep')">
              <input 
                type="checkbox" 
                value="test-prep"
                (change)="toggleService('test-prep')"
                name="serviceTestPrep">
              <span class="service-icon">🎯</span>
              <div class="service-content">
                <h4>Test Preparation</h4>
                <p>Focused exam readiness</p>
              </div>
            </label>
            
            <label class="service-item" [class.selected]="formData.services.includes('summer')">
              <input 
                type="checkbox" 
                value="summer"
                (change)="toggleService('summer')"
                name="serviceSummer">
              <span class="service-icon">☀️</span>
              <div class="service-content">
                <h4>Summer Programs</h4>
                <p>Enrichment during school breaks</p>
              </div>
            </label>
          </div>
        </div>
        
        <div class="payment-section">
          <h3 class="section-title">Payment Information</h3>
          
          <!-- <div class="payment-methods">
            <h4>Payment Method</h4>
            <div class="payment-options">
              <label class="payment-option" [class.selected]="formData.paymentMethod === 'credit'">
                <input 
                  type="radio" 
                  value="credit"
                  [(ngModel)]="formData.paymentMethod"
                  name="paymentMethod">
                <span class="radio-mark"></span>
                Credit Card
              </label>
              
              <label class="payment-option" [class.selected]="formData.paymentMethod === 'bank'">
                <input 
                  type="radio" 
                  value="bank"
                  [(ngModel)]="formData.paymentMethod"
                  name="paymentMethod">
                <span class="radio-mark"></span>
                Bank Transfer
              </label>
              
              <label class="payment-option" [class.selected]="formData.paymentMethod === 'paypal'">
                <input 
                  type="radio" 
                  value="paypal"
                  [(ngModel)]="formData.paymentMethod"
                  name="paymentMethod">
                <span class="radio-mark"></span>
                PayPal
              </label>
            </div>
          </div> -->
          
          <!-- <div class="form-group">
            <label class="form-label">Billing Frequency</label>
            <select 
              class="form-input" 
              [(ngModel)]="formData.billingFrequency"
              name="billingFrequency">
              <option value="monthly">Monthly</option>
              <option value="quarterly">Quarterly</option>
              <option value="yearly">Yearly</option>
            </select>
          </div> -->
          
          <div class="payment-note">
            <p>Payment details will be collected separately after registration is complete.</p>
            <p>By proceeding, you agree to our Terms of Service and Privacy Policy.</p>
          </div>
        </div>
        
        <div class="form-actions-final">
          <button type="button" class="btn-back" (click)="previousStep()">
            Previous
          </button>
          <!-- <button type="button" class="btn-download">
            📥 Download as ZIP
          </button> -->
          <button 
            type="button" 
            class="btn-complete" 
            (click)="onSubmit()"
            [disabled]="isSubmitting">
            <span *ngIf="isSubmitting">Submitting...</span>
            <span *ngIf="!isSubmitting">Complete Registration</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Review Modal Overlay -->
<div *ngIf="showReviewModal" class="review-modal-overlay" (click)="closeReviewModal()">
  <div class="review-modal-content" (click)="$event.stopPropagation()">
    <div class="review-modal-header">
      <h2 class="review-title">
        <span class="review-icon">📋</span>
        Review Your Registration
      </h2>
      <p class="review-subtitle">Please review all information before submitting</p>
      <button class="modal-close-btn" (click)="closeReviewModal()">
        <span class="close-icon">✕</span>
      </button>
    </div>
    
    <div class="review-modal-body">
      <!-- Personal Information Section -->
      <div class="review-section">
        <div class="review-section-header">
          <h3 class="review-section-title">
            <span class="section-icon">👤</span>
            Personal Information
          </h3>
          <button class="edit-section-btn" (click)="editSection(1)">
            <span class="edit-icon">✏️</span>
            Edit
          </button>
        </div>
        
        <div class="review-grid">
          <div class="review-item">
            <label class="review-label">Full Name</label>
            <span class="review-value">{{ formData.firstName }} {{ formData.lastName }}</span>
          </div>
          <div class="review-item">
            <label class="review-label">Email</label>
            <span class="review-value">{{ formData.email }}</span>
          </div>
          <div class="review-item">
            <label class="review-label">Phone</label>
            <span class="review-value">{{ formData.phone }}</span>
          </div>
          <div class="review-item">
            <label class="review-label">Profile Photo</label>
            <span class="review-value">{{ formData.profilePhoto ? 'Uploaded' : 'Not uploaded' }}</span>
          </div>
        </div>
      </div>
      
      <!-- Address Information Section -->
      <div class="review-section">
        <div class="review-section-header">
          <h3 class="review-section-title">
            <span class="section-icon">📍</span>
            Address Information
          </h3>
          <button class="edit-section-btn" (click)="editSection(2)">
            <span class="edit-icon">✏️</span>
            Edit
          </button>
        </div>
        
        <div class="review-grid">
          <div class="review-item full-width">
            <label class="review-label">Address</label>
            <span class="review-value">{{ formData.address }}</span>
          </div>
          <div class="review-item">
            <label class="review-label">City</label>
            <span class="review-value">{{ formData.city }}</span>
          </div>
          <div class="review-item">
            <label class="review-label">State</label>
            <span class="review-value">{{ formData.state }}</span>
          </div>
          <div class="review-item">
            <label class="review-label">ZIP Code</label>
            <span class="review-value">{{ formData.zipCode }}</span>
          </div>
        </div>
      </div>
      
      <!-- Students Information Section -->
      <div class="review-section">
        <div class="review-section-header">
          <h3 class="review-section-title">
            <span class="section-icon">👶</span>
            Students Information ({{ formData.students.length }} student{{ formData.students.length > 1 ? 's' : '' }})
          </h3>
          <button class="edit-section-btn" (click)="editSection(3)">
            <span class="edit-icon">✏️</span>
            Edit
          </button>
        </div>
        
        <div *ngFor="let student of formData.students; let i = index" class="student-review-card">
          <h4 class="student-review-title">Student {{ i + 1 }}: {{ student.name }}</h4>
          <div class="review-grid">
            <div class="review-item">
              <label class="review-label">Grade</label>
              <span class="review-value">{{ student.grade }}</span>
            </div>
            <div class="review-item">
              <label class="review-label">Age</label>
              <span class="review-value">{{ student.age }} years</span>
            </div>
            <!-- Previous Marks Review Item - NEW -->
            <div class="review-item full-width" *ngIf="student.previousMarks">
              <label class="review-label">Previous Class Marks</label>
              <span class="review-value">{{ student.previousMarks }}</span>
            </div>
            <div class="review-item full-width">
              <label class="review-label">Subjects</label>
              <div class="review-subjects">
                <span *ngFor="let subject of student.subjects" class="subject-tag">{{ subject }}</span>
              </div>
            </div>
            <div class="review-item full-width" *ngIf="student.challenges">
              <label class="review-label">Special Requirements</label>
              <span class="review-value">{{ student.challenges }}</span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Services & Payment Section -->
      <div class="review-section">
        <div class="review-section-header">
          <h3 class="review-section-title">
            <span class="section-icon">💼</span>
            Services & Payment
          </h3>
          <button class="edit-section-btn" (click)="editSection(4)">
            <span class="edit-icon">✏️</span>
            Edit
          </button>
        </div>
        
        <div class="review-grid">
          <div class="review-item full-width">
            <label class="review-label">Selected Services</label>
            <div class="review-services">
              <span *ngFor="let service of formData.services" class="service-tag">{{ getServiceDisplayName(service) }}</span>
            </div>
          </div>
          <div class="review-item">
            <label class="review-label">Registration Fee</label>
            <span class="review-value registration-fee">₹500</span>
          </div>
        </div>
      </div>
    </div>
    
    <div class="review-modal-footer">
      <div class="modal-footer-actions">
        <button class="btn-cancel" (click)="closeReviewModal()">
          Cancel
        </button>
        <button class="btn-download-review" (click)="downloadRegistrationData()">
          📥 Download Data
        </button>
        <button class="btn-confirm-submit" (click)="confirmAndSubmit()" [disabled]="isSubmitting">
          <span *ngIf="isSubmitting">Submitting...</span>
          <span *ngIf="!isSubmitting">✅ Confirm & Submit</span>
        </button>
      </div>
    </div>
  </div>
</div>